(function(){var t,e,o,s,n,i,r,l,a,p,h,f,c,u;o={rows:1,cols:1,transSpeed:500,index:0,data:[],controls:true,focusedClass:"focused",orientation:"horizontal",onChange:function(t){},onExit:function(t){},selectors:{container:"ul",wrapper:".wrapper",content:".content",focused:".focused",elem:"li",page:".page",tpl:'script[type="text/tpl"]'}};t={position:"relative",height:"100%"};u={overflow:"hidden",margin:0,padding:0};l={margin:0,padding:0,"float":"left"};n={"float":"left","list-style":"none"};a=function(t,e){var o,s;e=e||t.length;o=t.slice(0);s=[];while(o.length){s.push(o.splice(0,e))}return s};r=function(t){return typeof console!=="undefined"&&console!==null?console.log(t):void 0};s=function(t){return typeof console!=="undefined"&&console!==null?console.dir(t):void 0};f=function(t){t=t.replace("data-src","src");return function(e){var o,s,n,i;o="";for(n=0,i=e.length;n<i;n++){s=e[n];o+=t.replace(/\{(\w*)\}/g,function(t,e){return s[e]||t})}return o}};p=function(t,e){return t.querySelector(e)};h=function(t,e){var o,s,n,i,r;s=[];o=t.querySelectorAll(e);for(i=0,r=o.length;i<r;i++){n=o[i];if(n instanceof Element){s.push(n)}}return s};i=function(t){var e,o;o=getComputedStyle(t,null).getPropertyValue("margin-top");e=getComputedStyle(t,null).getPropertyValue("margin-bottom");return t.offsetHeight+parseFloat(o)+parseFloat(e)};c=function(t){var e,o;o=getComputedStyle(t,null).getPropertyValue("margin-right");e=getComputedStyle(t,null).getPropertyValue("margin-left");return t.offsetWidth+parseFloat(e)+parseFloat(o)};e=function(t,e){var o,s,n;s=[];if(t instanceof Element){for(o in e){n=e[o];s.push(""+o+": "+n)}t.setAttribute("style",s.join(";"))}return t};this.Gridy=function(){function s(t,e){var s,n,i,r,l,a,h,c,u,d,g,m,y=this;if(e==null){e={}}this.options={};for(i in o){h=o[i];this.options[i]=h}for(i in e){h=e[i];this.options[i]=h}this.el=p(document,t);if(!this.el){throw new Error("DOM element with selector "+t+" is not found")}this.wrapper=p(this.el,this.options.selectors.wrapper);this.content=p(this.el,this.options.selectors.content);r=p(this.el,this.options.selectors.tpl);if(!this.options.tpl){this.options.tpl=f(r.innerHTML)}a="";m=["WebkitT","MozT","OT","MsT","t"];for(c=0,d=m.length;c<d;c++){l=m[c];if(typeof document.body.style[l+"ransition"]==="string"){a=l+"ransition"}}if(!this.options.animate){this.options.animate=function(t,e,o){y.content.style[a]=""+o+"ms ease-in-out "+t;return y.content.style[t]=""+e+"px"}}if(this.options.data){this.insert(this.options.data)}if(this.options.controls){n=[];if(this.options.cols>1||e.rows===1){n.push("left");n.push("right")}if(this.options.rows>1){n.push("up");n.push("down")}for(u=0,g=n.length;u<g;u++){h=n[u];s=document.createElement("span");s.className=""+h+" control";s.innerHTML=h;s.direction=h;s.addEventListener("click",function(t){return y.move(t.currentTarget.direction)});this.el.appendChild(s)}}return this}s.prototype.insert=function(o){var s,r,p,f,d,g,m,y,w,v,b,x,T,C,L,E,S,k,A,M,z,F,H,P,V;if(o.length){y=this.options.cols*this.options.rows;w="";F=a(o,y);for(C=0,k=F.length;C<k;C++){T=F[C];w+='<ul class="page">'+this.options.tpl(T)+"</ul>"}if(w){this.content.innerHTML=w}this.elements=h(this.content,this.options.selectors.elem);this.pages=h(this.content,this.options.selectors.page);g=this.pages[0];d=this.elements[0];e(this.content,t);e(this.wrapper,u);if(this.elements){H=this.elements;for(L=0,A=H.length;L<A;L++){T=H[L];e(T,n)}}b=i(d);r=c(d);if(this.pages){P=this.pages;for(E=0,M=P.length;E<M;E++){T=P[E];e(T,l);T.style.height=""+b*this.options.rows+"px";T.style.width=""+r*this.options.cols+"px"}}this.wrapper.style.width=""+c(g)+"px";this.wrapper.style.height=""+i(g)+"px";if(this.options.orientation==="horizontal"){this.content.style.width=""+this.pages.length*c(g)+"px"}else{this.content.style.height=""+this.pages.length*i(g)+"px"}x={};p={};v=0;s=0;V=this.elements;for(S=0,z=V.length;S<z;S++){T=V[S];if(!x[T.offsetTop]){x[T.offsetTop]=[]}if(!p[T.offsetLeft]){p[T.offsetLeft]=[]}p[T.offsetLeft].push(T);x[T.offsetTop].push(T)}for(m in x){T=x[m];for(m in T){f=T[m];f.setAttribute("data-r",v)}v+=1}for(m in p){T=p[m];for(m in T){f=T[m];f.setAttribute("data-c",s)}s+=1}this.focus(this.elements[this.options.index],0)}return this};s.prototype.move=function(t){var e,o,s,n;o=p(this.content,this.options.selectors.focused);if(o){n=parseInt(o.getAttribute("data-r"));e=parseInt(o.getAttribute("data-c"));switch(t){case"left":e-=1;break;case"right":e+=1;break;case"up":n-=1;break;case"down":n+=1;break}s=p(this.content,"[data-r='"+n+"'][data-c='"+e+"']");if(s){s.classList.add(this.options.focusedClass);o.classList.remove(this.options.focusedClass);this.focus(s,this.options.transSpeed)}else{this.options.onExit(t)}}return this};s.prototype.focus=function(t,e){var o;if(e==null){e=0}if(t){t.classList.add(this.options.focusedClass);o=t.parentElement;if(this.options.orientation==="horizontal"){this.options.animate("left",-o.offsetLeft,e)}else{this.options.animate("top",-o.offsetTop,e)}this.options.onChange(t)}return this};return s}()}).call(this)